---
title: "Isotopes w/ Kevin and Matt - 04-01-2021"
author: "J Dawson"
date: '2021-03-31'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Importing Data}
rm(list=ls())

setwd("~/Desktop/Data/Working-Data")
library(naniar)
library(dplyr)
library(ggplot2)

###dataset for CompleteIso with the BsM comparison lakes from Kev/Tom
data <- read.csv("CompleteIsotopeswBsMCompLakes.csv")

##removing Fairbank and Endikai Lks b/c incomplete baselines
data <- data %>%
  filter(!grepl("Fairbank Lk.|Endikai Lk.", Water))

```

###Mismatching baseline isotope issue
*For the BsM lakes with multiple replicates of isotopes for a baseline were averaged to give the average C or N for that organism*
*Note that 3/4 of the BsM lakes are missing zoop isotopes and 1/4 is missing mayfly isotopes*

####Using each baseline organism taken to see comparability w/ mayfly and zoop isotopes.
*If not significantly different in same lake then could use as baseline for the lake(s) missing mayfly/zoop baselines*

**Endikai Lk. - crayfish, snail, trichopt.** -> removed
**Fairbank Lk. - mayfly** -> removed
**Richardson Lk. - clam, snail, mayfly, trichopt., zoop**
**Tadenac Lk. - clam, mayfly, ephemeri**
**Baby/Daisy/Nelson Lks. - mayfly, zoop, peri**

####Uncommon baselines to be removed/not included?
###IS THERE REASON TO KEEP THESE IN OTHER THAN FOR BASELINES? DO THEY HELP INFORM/FRAME THE BIG PICTURE OF LAKE ISOSCAPES?

```{r Comparing baselines}
##Subsetting data for just baselines
base_data <- data %>%
  filter(grepl("EPH|ZOOP|PERI|MAYFLY|HEPTAGEN|EPHEMERI|SNAIL|TRICHOPT|CLAM|CRAYFISH", TAXON))

##Subsetting to use Richardson Lk (most isotopes)
base_data_rc <- base_data %>%
  filter(grepl("Richardson Lk.", Water))

##Using Richardson Lk. to see if trichoptera and mayfly are comparable or if snail and mayfly are a better match

######################
# TRICHOPT v. MAYFLY #
######################
ggplot(subset(base_data_rc, TAXON %in% c("TRICHOPT", "MAYFLY")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-30,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Mayfly-Trichopt comparison", x = "d13C", y = "d15N")
#coordinates: mayfly (-25.21,3.25), trichopt(-24.31,1.06 and -21.48,0.77)

######################
##  SNAIL v. MAYFLY ##
######################
ggplot(subset(base_data_rc, TAXON %in% c("SNAIL", "MAYFLY")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-30,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Mayfly-Snail comparison", x = "d13C", y = "d15N")
#coordinates: mayfly (-25.21,3.25), snail(-17.46,1.53)

##Using Richardson Lk. to see if snails or clams are comparable to zoop baselines
######################
##   CLAM v. ZOOP   ##
######################
ggplot(subset(base_data_rc, TAXON %in% c("CLAM", "ZOOP")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-33,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Zoop-Clam comparison", x = "d13C", y = "d15N")
#coordinates: zoop (-32.22,2.24), clam (-30.80,2.02)

######################
##  SNAIL v. ZOOP   ##
######################
ggplot(subset(base_data_rc, TAXON %in% c("SNAIL", "ZOOP")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-33,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Zoop-Snail comparison", x = "d13C", y = "d15N")
#coordinates: zoop (-32.22,2.24), snail (-17.46,1.53)

##Using Tadenac Lk. -- determining whether mayflies labelled as EPH are comparable (can be included) with those labelled MAYFLY
##Subsetting for Tadenac baselines
base_data_td <- base_data %>%
  filter(grepl("Tadenac Lk.", Water))

######################
# EPHEMERI v. MAYFLY #
######################
ggplot(subset(base_data_td, TAXON %in% c("EPHEMERI", "MAYFLY")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-30,-15) + ylim(0,6) +
  labs(title = "Tadenac Lk. Mayfly-Ephemeri comparison", x = "d13C", y = "d15N")

```
#DELIBERATION
*TRICHOPT seems to be the best-fitting baseline to use in-lieu of mayflyies for Endikai, but is it similar enough to use?*

*CLAM is the best-fitting baseline to use in-lieu of zoop for Tadenac (very close) but snail is not similar in d13C... could it be used for Endikai or is there a known substitute that's better? Can't compare crayfish and it has far too high 15N (5+)*

*MAYFLY seems to differ from the cluster of EPHEMERI baselines in Tadenac, but is it different enough that it should not be included in the EMPHEMERI grouping?*
*Mean Mayfly is (-23.42, 1.21) and Ephemeri is (-27.505,3.966667)*

###WHAT BASELINE(S) SHOULD BE USED FOR CALCULATING PROP LITTORAL?
**Mayfly/trichoptera for littoral?**
**Would use zoop but 3/4 of the BsM lakes don't have it... Fairbank only has mayfly baselines unless a planktivorous fish could be used (N issues?)**


###Calculating the mean C and N values for the baselines
```{r Baseline mean C and Ns by TAXON within each lake}
base_data$TAXON[base_data$TAXON == "MAYFLY"] <- "EPH"
base_data$TAXON[base_data$TAXON == "HEPTAGEN"] <- "EPH"

base_data_sum <- base_data %>%
  group_by(Water, TAXON) %>%
  summarise(mean_d13C = mean(d13C), mean_d15N = mean(d15N))

ggplot(base_data_sum, aes(x = mean_d13C, y = mean_d15N,  colour = Water, shape = TAXON, group = Water)) +
  geom_point() +
  scale_shape_manual(values = 0:8) +
  theme_classic(base_size = 14) +
  xlim(-35,-15) + ylim(0,5) +
  labs(title = "Baselines comparison", x = "d13C", y = "d15N")

ggplot(subset(base_data_sum, TAXON %in% c("EPH", "EPHEMERI", "TRICHOPT", "ZOOP")), aes(x = mean_d13C, y = mean_d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-35,-15) + ylim(0,5) +
  labs(title = "Baselines comparison w/ less taxa", x = "d13C", y = "d15N")


```


###Adding columns specific to each baseline and adding mean C and N for baselines (individual and hybrid/mixed)
*Adding columns specific to each baseline organism*

```{r Adding C + N columns for all the baselines}
##add baselines as columns for C + N
### ZOOP ### - MISSING ENDIKAI, FAIRBANK, AND TADENAC
data$d13C_zoop<-NA
data$d13C_zoop[data$Water == "Baby Lk."] <- -30.69
data$d13C_zoop[data$Water == "Daisy Lk."] <- -32.93
data$d13C_zoop[data$Water == "Nelson Lk."] <- -34.07
data$d13C_zoop[data$Water == "Richardson Lk."] <- -32.220675
data$d15N_zoop<- NA
data$d15N_zoop[data$Water == "Baby Lk."] <- 1.85
data$d15N_zoop[data$Water == "Daisy Lk."] <- 3.10
data$d15N_zoop[data$Water == "Nelson Lk."] <- 3.60
data$d15N_zoop[data$Water == "Richardson Lk."] <- 2.235965

### EPH (Mayfly) ### - ALL BUT ENDIKAI
data$d13C_eph <- NA
data$d13C_eph[data$Water == "Baby Lk."] <- -28.08
data$d13C_eph[data$Water == "Daisy Lk."] <- -25.88
data$d13C_eph[data$Water == "Nelson Lk."] <- -26.97
data$d13C_eph[data$Water == "Fairbank Lk."] <- -23.908
data$d13C_eph[data$Water == "Tadenac Lk."] <- -26.92143
data$d13C_eph[data$Water == "Richardson Lk."] <- -25.215266
data$d15N_eph <- NA
data$d15N_eph[data$Water == "Baby Lk."] <- 3.60
data$d15N_eph[data$Water == "Daisy Lk."] <- 1.69
data$d15N_eph[data$Water == "Nelson Lk."] <- 0.88
data$d15N_eph[data$Water == "Fairbank Lk."] <- 0.528
data$d15N_eph[data$Water == "Tadenac Lk."] <- 3.572857
data$d15N_eph[data$Water == "Richardson Lk."] <- 3.247864

###  EPH W/ TRICHOPT (ENDIKAI) ### - ALL LAKES
data$d13C_ephtri <- data$d13C_eph
data$d13C_ephtri[data$Water == "Endikai Lk."] <- -27.23
data$d15N_ephtri <- data$d15N_eph
data$d15N_ephtri[data$Water == "Endikai Lk."] <- 1.88

### PERI ###
data$d13C_peri <- NA
data$d13C_peri[data$Water == "Baby Lk."] <- -26.95
data$d13C_peri[data$Water == "Daisy Lk."] <- -28.47
data$d13C_peri[data$Water == "Nelson Lk."] <- -25.74
data$d15N_peri <- NA
data$d15N_peri[data$Water == "Baby Lk."] <- 1.14
data$d15N_peri[data$Water == "Daisy Lk."] <- 2.19
data$d15N_peri[data$Water == "Nelson Lk."] <- 1.59

### SNAIL ###
data$d13C_snail <- NA
data$d13C_snail[data$Water == "Endikai Lk."] <- -21.240
data$d13C_snail[data$Water == "Richardson Lk."] <- -17.46507
data$d15N_snail <- NA
data$d15N_snail[data$Water == "Endikai Lk."] <- 2.65
data$d15N_snail[data$Water == "Richardson Lk."] <- 1.533382

### CLAM ###
data$d13C_clam <- NA
data$d13C_clam[data$Water == "Tadenac Lk."] <- -27.796
data$d13C_clam[data$Water == "Richardson Lk."] <- -30.80193
data$d15N_clam <- NA
data$d15N_clam[data$Water == "Tadenac Lk."] <- 3.595
data$d15N_clam[data$Water == "Richardson Lk."] <- 2.019227

### ZOOP-CLAM ### - ALL BUT ENDIKAI AND FAIRBANK
data$d13C_zoopclam <- data$d13C_zoop
data$d13C_zoopclam[data$Water == "Tadenac Lk."] <- -27.796
data$d15N_zoopclam <- data$d15N_zoop
data$d15N_zoopclam[data$Water == "Tadenac Lk."] <- 3.595

### ZOOP-CLAM-SNAIL ### - ALL BUT FAIRBANK
data$d13C_ZCS <- data$d13C_zoopclam
data$d13C_ZCS[data$Water == "Endikai Lk."] <- -21.240
data$d15N_ZCS <- data$d15N_zoopclam
data$d15N_ZCS[data$Water == "Endikai Lk."] <- 2.65

```

##Just reformatting the data frame
*Removing all baselines as rows, renaming, adding thermal guilds.*

```{r Reformatting the data frame}
##remove baseline entries as rows + site column (only need for peri)
data<-data[,-c(2)]
data <- data %>%
  filter(!grepl("EPH|ZOOP|PERI|MAYFLY|HEPTAGEN|EPHEMERI|TRICHOPT|CRAYFISH|CLAM|SNAIL", TAXON))

##removing the entries with NA for C/N
data <- data[!is.na(data$d13C),]

##renaming some of the fish species to match each other
data$TAXON[data$TAXON == "COSHIN"] <- "COSHINER"
data$TAXON[data$TAXON == "NP"] <- "NPIKE"

##adding size class (prey/pred) for few Richardson entries missing it
data$SIZE[data$Water == "Richardson Lk." & is.na(data$SIZE)] <- "Pred"

##adding in thermal guild information for all fish spc
data$thermguild <- NA
data$thermguild[data$TAXON == "NPIKE"] <- "Cool"
data$thermguild[data$TAXON == "WS"] <- "Cool"
data$thermguild[data$TAXON == "SMB"] <- "Cool"
data$thermguild[data$TAXON == "WALL"] <- "Cool"
data$thermguild[data$TAXON == "COSHINER"] <- "Cool"
data$thermguild[data$TAXON == "CCHUB"] <- "Cool"
data$thermguild[data$TAXON == "PSEED"] <- "Warm"
data$thermguild[data$TAXON == "YPERCH"] <- "Cool"
data$thermguild[data$TAXON == "BBULL"] <- "Warm"
data$thermguild[data$TAXON == "BUR"] <- "Cold"
data$thermguild[data$TAXON == "LT"] <- "Cold"
data$thermguild[data$TAXON == "LWF"] <- "Cold"
data$thermguild[data$TAXON == "RT"] <- "Cold"
data$thermguild[data$TAXON == "SPSHINER"] <- "Cold"
data$thermguild[data$TAXON == "CISCO"] <- "Cold"
data$thermguild[data$TAXON == "RSMELT"] <- "Cold"  
data$thermguild[data$TAXON == "BNMIN"] <-  "Cool"
data$thermguild[data$TAXON == "LPERCH"] <- "Cool"
data$thermguild[data$TAXON == "RBASS"] <- "Cool" 
data$thermguild[data$TAXON == "SLSCULP"] <- "Cold"
data$thermguild[data$TAXON == "DWSCULP"] <- "Cold"
data$thermguild[data$TAXON == "SPSCULP"] <- "Cold"
data$thermguild[data$TAXON == "ALEWIFE"] <- "Cold"
data$thermguild[data$TAXON == "GOSHINER"] <- "Cool"  
data$thermguild[data$TAXON == "NSSTICK"] <- "Cold"
  
##subsetting data by lake bc facet got fucked
data_bb <- subset(data, data$Water == "Baby Lk.")
data_dy <- subset(data, data$Water == "Daisy Lk.")
data_nl <- subset(data, data$Water == "Nelson Lk.")
data_td <- subset(data, data$Water == "Tadenac Lk.")
data_rc <- subset(data, data$Water == "Richardson Lk.")
  
  
```

##Plotting the Fish Isoscapes in each lake with 40% CI species ellipses and showing thermal guilds. 
**Note that the fish species are represented by different colours across lakes because there are so many unique species across all the lakes**

```{r Isoscapes for all fish species by lake, echo=FALSE}
library(ggplot2)
#ggplot(data, aes(x = d13C, y = d15N,  colour = TAXON, shape = Water, group = interaction(Water, TAXON))) +
  #geom_point() +
  #stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  #theme_classic(base_size = 14) +
  #facet_wrap(~Water)

##################################
########ISOSCAPES BY LAKE#########
##################################

#################
## STUDY LAKES ##
#################

###Baby Lake###
ggplot(data_bb, aes(x = d13C, y = d15N,  colour = TAXON, shape = SIZE, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Baby Lake Fish Isotope w/ Species Ellipses", x = "d13C", y = "d15N")

ggplot(data_bb, aes(x = d13C, y = d15N,  colour = TAXON, shape = thermguild, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Baby Lake Fish Isotope w/ Species Ellipses (thermal)", x = "d13C", y = "d15N")

###Daisy Lake###
ggplot(data_dy, aes(x = d13C, y = d15N,  colour = TAXON, shape = SIZE, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Daisy Lake Fish Isotope w/ Species Ellipses", x = "d13C", y = "d15N")

ggplot(data_dy, aes(x = d13C, y = d15N,  colour = TAXON, shape = thermguild, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Daisy Lake Fish Isotope w/ Species Ellipses (thermal)", x = "d13C", y = "d15N")

###Nelson Lake###
ggplot(data_nl, aes(x = d13C, y = d15N,  colour = TAXON, shape = SIZE, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Nelson Lake Fish Isotope w/ Species Ellipses", x = "d13C", y = "d15N")

ggplot(data_nl, aes(x = d13C, y = d15N,  colour = TAXON, shape = thermguild, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Nelson Lake Fish Isotope w/ Species Ellipses (thermal)", x = "d13C", y = "d15N")

###############
## BsM LAKES ##
###############

####Richardson Lk####
ggplot(data_rc, aes(x = d13C, y = d15N,  colour = TAXON, shape = SIZE, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Richardson Lake Fish Isotope w/ Species Ellipses", x = "d13C", y = "d15N")

ggplot(data_rc, aes(x = d13C, y = d15N,  colour = TAXON, shape = thermguild, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Richardson Lake Fish Isotope w/ Species Ellipses (thermal)", x = "d13C", y = "d15N")

####Tadenac Lk####
ggplot(data_td, aes(x = d13C, y = d15N,  colour = TAXON, shape = SIZE, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Tadenac Lake Fish Isotope w/ Species Ellipses", x = "d13C", y = "d15N")

ggplot(data_td, aes(x = d13C, y = d15N,  colour = TAXON, shape = thermguild, group = TAXON)) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Tadenac Lake Fish Isotope w/ Species Ellipses (thermal)", x = "d13C", y = "d15N")

```

```{r Fish isoscapes for common species across lakes}
##all together
ggplot(subset(data, TAXON %in% c("YPERCH", "SMB")), aes(x = d13C, y = d15N, colour = Water, shape = TAXON, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Common fish isotopes across lakes", x = "d13C", y = "d15N")

##facetted
ggplot(subset(data, TAXON %in% c("YPERCH", "SMB")), aes(x = d13C, y = d15N, colour = TAXON, shape = SIZE, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water)

```

```{r Calculating proportion littoral energy usage w/ various baseline combos, echo=FALSE}
##coupling - fix it a little bit

###################
##  STUDY LAKES  ##
###################
#peri (L) - zoop (P)
data$prop_litt_PZ <- (data$d13C - data$d13C_zoop)/(data$d13C_peri - data$d13C_zoop)
#adjusted peri (<0 and 100<)
data$adjprop_litt_PZ <- NA
data$adjprop_litt_PZ = data$prop_litt_PZ
data$adjprop_litt_PZ[data$prop_litt_PZ>1] <- 1.00
data$adjprop_litt_PZ[data$prop_litt_PZ<0] <- 0.00

#mayfly (L) - zoop (P) - ADDED RICHARDSON
data$prop_litt_ET <- (data$d13C - data$d13C_zoop)/(data$d13C_eph - data$d13C_zoop)

###################
##  STUDY + BsM  ##
###################
#eph/trichoptera (L) - zoop/clam/snail (P) - MISSING FAIRBANK
data$prop_litt_ET_ZCS <- (data$d13C - data$d13C_ZCS)/(data$d13C_ephtri - data$d13C_ZCS)
data<- data[!is.na(data$prop_litt_ET_ZCS),]
hist(data$prop_litt_ET_ZCS)
#adjusted (<0 and 100<)
data$adjprop_litt_ET_ZCS <- NA
data$adjprop_litt_ET_ZCS = data$prop_litt_ET_ZCS
data$adjprop_litt_ET_ZCS[data$prop_litt_ET_ZCS>1] <- 1.00
data$adjprop_litt_ET_ZCS[data$prop_litt_ET_ZCS<0] <- 0.00
hist(data$adjprop_litt_ET_ZCS)

```

```{r Proportion Littoral histograms to find best fit}
#################
###   PERI   ####
#################
#BINNING#
pl_breaks <- c(-1.5, 0, 0.25, 0.5, 0.75, 1.0, 2.5)
# specify interval/bin labels
pl_tags <- c("[1.5-0)","[0-0.25)", "[0.26-0.50)", "[0.51-0.75)", "[0.76-1.0)", "[1.01-2.50)")
pl_group_tags <- cut(data$prop_litt_PZ, 
                  breaks=pl_breaks, 
                  include.lowest=TRUE, 
                  right=FALSE, 
                  labels=pl_tags)
v <- data %>% select(prop_litt_PZ, TAXON) #pick the variable 
pl_bin <- as_tibble(v) %>% 
  mutate(tag = case_when(
    prop_litt_PZ < 0 ~ pl_tags[1],
    prop_litt_PZ >= 0 & prop_litt_PZ < 0.25 ~ pl_tags[2],
    prop_litt_PZ >= 0.25 & prop_litt_PZ < 0.5 ~ pl_tags[3],
    prop_litt_PZ >= 0.5 & prop_litt_PZ < 0.75 ~ pl_tags[4],
    prop_litt_PZ >= 0.75 & prop_litt_PZ <= 1.0 ~ pl_tags[5],
    prop_litt_PZ > 1.0 & prop_litt_PZ < 2.5 ~ pl_tags[6]
    ))
summary(pl_bin)
pl_bin$tag <- factor(pl_bin$tag,
                       levels = pl_tags,
                       ordered = FALSE)
summary(pl_bin$tag)
##Frequencies based on bins
pl_freq<- plyr::count(pl_bin, "tag")
# Counts the number of observations according to FLEN
pl_freq$freqlbls <- as.character(pl_freq$freq)
# Calculating percent in each size class
pl_freq$pct <- round(pl_freq$freq/sum(pl_freq$freq)*100)
pl_freq$pctlbls <- as.character(pl_freq$pct)
# Adding % to the labels
pl_freq$pctlbls <- paste(pl_freq$pctlbls,"%",sep="")

## histogram w/ percent labels
ggplot(data=pl_freq, aes(x=tag, y=freq))+
  geom_bar(stat="identity",width=1, colour = "black")+
  xlab("Proportion Littoral Energy")+
  ylab("Frequency")+
  ggtitle("Distribution of Proportion of Littoral Energy (peri-zoop)")+
  scale_y_continuous()+
  scale_x_discrete()+
  geom_text(aes(label=pctlbls), vjust=-0.5)+
  theme_bw()

################
###  MAYFLY  ###
################
plE_tags <- c("[1.5-0)","[0-0.25)", "[0.26-0.50)", "[0.51-0.75)", "[0.76-1.0)", "[1.01-2.50)")
plE_group_tags <- cut(data$prop_litt_ET, 
                  breaks=pl_breaks, 
                  include.lowest=TRUE, 
                  right=FALSE, 
                  labels=plE_tags)
u <- data %>% select(prop_litt_ET, TAXON) #pick the variable 
plE_bin <- as_tibble(u) %>% 
  mutate(tag = case_when(
    prop_litt_ET < 0 ~ plE_tags[1],
    prop_litt_ET >= 0 & prop_litt_ET < 0.25 ~ plE_tags[2],
    prop_litt_ET >= 0.25 & prop_litt_ET < 0.5 ~ plE_tags[3],
    prop_litt_ET >= 0.5 & prop_litt_ET < 0.75 ~ plE_tags[4],
    prop_litt_ET >= 0.75 & prop_litt_ET <= 1.0 ~ plE_tags[5],
    prop_litt_ET > 1.0 & prop_litt_ET < 2.5 ~ plE_tags[6]
    ))
summary(plE_bin)
plE_bin$tag <- factor(plE_bin$tag,
                       levels = pl_tags,
                       ordered = FALSE)
summary(plE_bin$tag)
##Frequencies based on bins
plE_freq<- plyr::count(plE_bin, "tag")
# Counts the number of observations according to FLEN
plE_freq$freqlbls <- as.character(plE_freq$freq)
# Calculating percent in each size class
plE_freq$pct <- round(plE_freq$freq/sum(plE_freq$freq)*100)
plE_freq$pctlbls <- as.character(plE_freq$pct)
# Adding % to the labels
plE_freq$pctlbls <- paste(plE_freq$pctlbls,"%",sep="")

##mayfly histogram w/ percent labels
ggplot(data=plE_freq, aes(x=tag, y=freq))+
  geom_bar(stat="identity",width=1, colour = "black")+
  xlab("Proportion Littoral Energy")+
  ylab("Frequency")+
  ggtitle("Distribution of Proportion of Littoral Energy (mayfly-zoop)")+
  scale_y_continuous()+
  scale_x_discrete()+
  geom_text(aes(label=pctlbls), vjust=-0.5)+
  theme_bw()


#######################
###  EPH/TRI + ZCS  ###
#######################
plZCS_tags <- c("[-4.5-0)","[0-0.25)", "[0.26-0.50)", "[0.51-0.75)", "[0.76-1.0)", "[1.01-6.50)")
plZCS_group_tags <- cut(data$prop_litt_ET_ZCS, 
                  breaks=pl_breaks, 
                  include.lowest=TRUE, 
                  right=FALSE, 
                  labels=plZCS_tags)
W <- data %>% select(prop_litt_ET_ZCS, TAXON) #pick the variable 
plZCS_bin <- as_tibble(W) %>% 
  mutate(tag = case_when(
    prop_litt_ET_ZCS < 0 ~ plZCS_tags[1],
    prop_litt_ET_ZCS >= 0 & prop_litt_ET_ZCS < 0.25 ~ plZCS_tags[2],
    prop_litt_ET_ZCS >= 0.25 & prop_litt_ET_ZCS < 0.5 ~ plZCS_tags[3],
    prop_litt_ET_ZCS >= 0.5 & prop_litt_ET_ZCS < 0.75 ~ plZCS_tags[4],
    prop_litt_ET_ZCS >= 0.75 & prop_litt_ET_ZCS <= 1.0 ~ plZCS_tags[5],
    prop_litt_ET_ZCS > 1.0 & prop_litt_ET_ZCS < 6.5 ~ plZCS_tags[6]
    ))
summary(plZCS_bin)
plZCS_bin$tag <- factor(plZCS_bin$tag,
                       levels = plZCS_tags,
                       ordered = FALSE)
summary(plZCS_bin$tag)
##Frequencies based on bins
plZCS_freq<- plyr::count(plZCS_bin, "tag")
# Counts the number of observations according to FLEN
plZCS_freq$freqlbls <- as.character(plZCS_freq$freq)
# Calculating percent in each size class
plZCS_freq$pct <- round(plZCS_freq$freq/sum(plZCS_freq$freq)*100)
plZCS_freq$pctlbls <- as.character(plZCS_freq$pct)
# Adding % to the labels
plZCS_freq$pctlbls <- paste(plZCS_freq$pctlbls,"%",sep="")

##EPH/TRI + ZOOP/CLAM/SNAIL histogram w/ percent labels
ggplot(data=plZCS_freq, aes(x=tag, y=freq))+
  geom_bar(stat="identity",width=1, colour = "black")+
  xlab("Proportion Littoral Energy")+
  ylab("Frequency")+
  ggtitle("Distribution of Proportion of Littoral Energy (EPH/TRI-ZOOP/CLAM/SNAIL)")+
  scale_y_continuous()+
  scale_x_discrete()+
  geom_text(aes(label=pctlbls), vjust=-0.5)+
  theme_bw()
```

```{r Summarizing data to make proportion littoral plots}
#summarize data for plots 
data_sum <- data %>% group_by(Water, TAXON) %>%
  summarise(mean.pl = mean(prop_litt_ET_ZCS), sd.pl = sd(prop_litt_ET_ZCS), mean.adjpl = mean(adjprop_litt_ET_ZCS), sd.adjpl = sd(adjprop_litt_ET_ZCS))

#binding ogether to create master data frame w/ all baseline C/Ns, mean proplittoral
bigdat <- merge(data, data_sum, by = c("Water", "TAXON"))
  
#summarizing data by lake
data_pl_lake <- data %>% group_by(Water) %>%
  summarise(mean.pl = mean(prop_litt_ET_ZCS), sd.pl = sd(prop_litt_ET_ZCS), mean.adjpl = mean(adjprop_litt_ET_ZCS), sd.adjpl = sd(adjprop_litt_ET_ZCS))

#subsetting for PL by spp.
data_pl <- data[,c(1:3,29,30)]
data_pl_YP <- data_pl[data_pl$TAXON == "YPERCH",]
data_pl_SMB <- data_pl[data_pl$TAXON == "SMB",]

##############
###  PLOT  ###
##############

#################################
### EPH/TRI + ZOOP/CLAM/SNAIL ###
#################################
##BOXPLOTS
ggplot(bigdat, aes(x = TAXON, y = prop_litt_ET_ZCS, fill = TAXON, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Prop. litt. energy using mixed EPH/TRI (L) and ZCS (P) (unadjusted)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#adj
ggplot(bigdat, aes(x = TAXON, y = adjprop_litt_ET_ZCS, fill = TAXON, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Prop. litt. energy using mixed EPH/TRI (L) and ZCS (P) (adjusted)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

##MEAN +/- sd
ggplot(bigdat, aes(x = TAXON, y = mean.pl, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.pl + sd.pl, ymin = mean.pl - sd.pl)) +
  xlab("Fish species") +
  ylab("Mean prop. litt. energy +/- sd (ET - ZCS)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

ggplot(bigdat, aes(x = TAXON, y = mean.pl, colour = thermguild, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.pl + sd.pl, ymin = mean.pl - sd.pl)) +
  xlab("Fish species") +
  ylab("Mean prop. litt. energy +/- sd (ET - ZCS) w/ colour by thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#adj
ggplot(bigdat, aes(x = TAXON, y = mean.adjpl, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.adjpl + sd.adjpl, ymin = mean.adjpl - sd.adjpl)) +
  xlab("Fish species") +
  ylab("Mean adj-prop. litt. energy +/- sd (ET - ZCS)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

ggplot(bigdat, aes(x = TAXON, y = mean.adjpl, colour = thermguild, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.adjpl + sd.adjpl, ymin = mean.adjpl - sd.adjpl)) +
  xlab("Fish species") +
  ylab("Mean adj-prop. litt. energy +/- sd (ET - ZCS) w/ colour by thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

###BY LAKE - WHOLE LAKE AVG
ggplot(data_pl_lake, aes(x = Water, y = mean.pl, colour = Water, group = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.pl + sd.pl, ymin = mean.pl - sd.pl)) +
  xlab("Lake") +
  ylab("Mean prop. litt. energy +/- sd (ET - ZCS)") +
  scale_y_continuous() +
  scale_x_discrete() +
  theme_bw()

ggplot(data_pl_lake, aes(x = Water, y = mean.adjpl, colour = Water, group = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.adjpl + sd.adjpl, ymin = mean.adjpl - sd.adjpl)) +
  xlab("Lake") +
  ylab("Mean adj-prop. litt. energy +/- sd (ET - ZCS)") +
  scale_y_continuous() +
  scale_x_discrete() +
  theme_bw() 
```

```{r ANOVA sig. differences between lakes prop littoral}
yp_pl_aov<-aov(prop_litt_ET_ZCS ~ Water, data = data_pl_YP)
summary(yp_pl_aov)

TukeyHSD(yp_pl_aov, which = "Water")

smb_pl_aov<-aov(prop_litt_ET_ZCS ~ Water, data = data_pl_SMB)
summary(smb_pl_aov)

TukeyHSD(smb_pl_aov, which = "Water")

#adj
yp_adjpl_aov<-aov(adjprop_litt_ET_ZCS ~ Water, data = data_pl_YP)
summary(yp_adjpl_aov)

TukeyHSD(yp_adjpl_aov, which = "Water")

smb_adjpl_aov<-aov(adjprop_litt_ET_ZCS ~ Water, data = data_pl_SMB)
summary(smb_adjpl_aov)

TukeyHSD(smb_adjpl_aov, which = "Water")
```

> range(data$prop_littoral)
[1] -0.815508  1.743316
> mean(data$prop_littoral)
[1] 0.8562738
> median(data$prop_littoral)
[1] 0.9117647

> range(data$prop_littoral2)
[1] -1.168582  2.498084
> mean(data$prop_littoral2)
[1] 0.8460624
> median(data$prop_littoral2)
[1] 0.7676056

```{r Matt code - TP, echo=FALSE}
##trophic position
data$tp_ZCS <- 2 + ((data$d15N - data$d15N_ZCS)/3.4)
                     
data$tp_EPHTRI <- 2 + ((data$d15N - data$d15N_ephtri)/3.4)

# two baseline
data$tp_2 <- 2 + ((data$d15N - ((data$d15N_ZCS*(1 - data$prop_litt_ET_ZCS)) + (data$d15N_ephtri*data$prop_litt_ET_ZCS)))/3.4)

#summarize data for plots
data_sum_tp <- data %>% group_by(Water, TAXON) %>%
  summarise(mean.tp.zoop = mean(tp_ZCS), sd.tp.zoop = sd(tp_ZCS), mean.tp.eph = mean(tp_EPHTRI), sd.tp.eph = sd(tp_EPHTRI))

###############
###  PLOTS  ###
###############
#Zoop - mean
ggplot(data_sum_tp, aes(x = TAXON, y = mean.tp.zoop, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (zoop/clam/snail)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Zoop - quantile boxplot
ggplot(data, aes(x = TAXON, y = tp_ZCS, fill = thermguild, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Trophic Position (zoop) w/ thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Mayfly - mean
ggplot(data_sum_tp, aes(x = TAXON, y = mean.tp.eph, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (eph/tri)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Mayfly - quantile
ggplot(data, aes(x = TAXON, y = tp_EPHTRI, fill = thermguild, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Trophic Position (eph/tri) w/ thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
```

> range(data$tp_ZCS)
[1] 2.270588 5.223529
> mean(data$tp_ZCS)
[1] 3.571591
> median(data$tp_ZCS)
[1] 3.523529

> range(data$tp_EPHTRI)
[1] 1.950000 5.45
> mean(data$tp_EPHTRI)
[1] 3.682063
> median(data$tp_EPHTRI)
[1] 3.722581


