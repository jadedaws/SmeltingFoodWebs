---
title: "Isotopes w/ Kevin and Matt - 04-01-2021"
author: "J Dawson"
date: '2021-03-31'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Importing Data}
rm(list=ls())

library(naniar)
library(dplyr)
library(ggplot2)
library(readr)

###Github connection to McCann & Johnson dataset for CompleteIso with the BsM comparison lakes
data <- read_csv("../data/CompleteIsotopeswBsMCompLakes.csv")

###Removing Fairbank and Endikai Lks b/c incomplete baselines
data <- data %>%
  filter(!grepl("Fairbank Lk.|Endikai Lk.", Water))

```

```{r Comparing baseline isoscapes generally}
##Subsetting data for just baselines
base_data <- data %>%
  filter(grepl("EPH|ZOOP|PERI|MAYFLY|EPHEMERI|SNAIL|TRICHOPT|CLAM", TAXON))

base_data$TAXON[base_data$TAXON == "EPH"] <- "MAYFLY"
base_data$TAXON[base_data$TAXON == "EPHEMERI"] <- "MAYFLY"

##########################
## STUDY LAKES BASELINES##
##########################
ggplot(subset(base_data, Water %in% c("Baby Lk.", "Daisy Lk.", "Nelson Lk.")), aes(x = d13C, y = d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  scale_shape_manual(values = c(15,16,1)) +
  theme_classic(base_size = 14) +
  xlim(-35,-15) + ylim(0,6) +
  labs(title = "Study lakes baselines comparison", x = "d13C", y = "d15N")

##########################
##  REF LAKES BASELINES ##
##########################
ggplot(subset(base_data, Water %in% c("Tadenac Lk.", "Richardson Lk.")), aes(x = d13C, y = d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  scale_shape_manual(values = c(0,15:17,1)) +
  theme_classic(base_size = 14) +
  xlim(-35,-15) + ylim(0,6) +
  labs(title = "BsM lakes baselines comparison", x = "d13C", y = "d15N")

##########################
##  ALL LAKES BASELINES ##
##########################
ggplot(base_data, aes(x = d13C, y = d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  scale_shape_manual(values = c(0,15:18,1)) +
  theme_classic(base_size = 14) +
  xlim(-35,-15) + ylim(0,6) +
  labs(title = "All lakes baselines comparison - (Littoral fill)", x = "d13C", y = "d15N")

ggplot(subset(base_data, TAXON %in% c("CLAM", "MAYFLY", "TRICHOPT", "ZOOP")), aes(x = d13C, y = d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  scale_shape_manual(values = c(0,15,18,1)) +
  theme_classic(base_size = 14) +
  xlim(-35,-20) + ylim(0,5) +
  labs(title = "Usable baselines comparison - (Littoral fill)", x = "d13C", y = "d15N")

```

```{r Comparing baselines to use: Richardson Lk example}
##Subsetting to use Richardson Lk (most isotopes)
base_data_rc <- base_data %>%
  filter(grepl("Richardson Lk.", Water))

##Using Richardson Lk. to see if trichoptera and mayfly / zoop and clam are comparable as this is the only lake with all 4 baselines collected. 

######################
# TRICHOPT v. MAYFLY #
######################
ggplot(subset(base_data_rc, TAXON %in% c("TRICHOPT", "MAYFLY")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-30,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Mayfly-Trichopt comparison", x = "d13C", y = "d15N")
#coordinates: mayfly (-25.21,3.25), trichopt(-24.31,1.06 and -21.48,0.77)

######################
##   CLAM v. ZOOP   ##
######################
ggplot(subset(base_data_rc, TAXON %in% c("CLAM", "ZOOP")), aes(x = d13C, y = d15N,  colour = TAXON, group = TAXON)) +
  geom_point() +
  theme_classic(base_size = 14) +
  xlim(-33,-15) + ylim(0,6) +
  labs(title = "Richardson Lk. Zoop-Clam comparison", x = "d13C", y = "d15N")
#coordinates: zoop (-32.22,2.24), clam (-30.80,2.02)

```
```{r Mean C and N by TAXON within each lake}
base_data_sum <- base_data %>%
  group_by(Water, TAXON) %>%
  summarise(mean_d13C = mean(d13C), mean_d15N = mean(d15N), sd_d13C = sd(d13C), sd_d15N = sd(d15N))

## Baseline mean C and N plot ##
ggplot(subset(base_data_sum, TAXON %in% c("CLAM","MAYFLY", "TRICHOPT", "ZOOP")), aes(x = mean_d13C, y = mean_d15N,  colour = Water, shape = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean_d15N + sd_d15N, ymin = mean_d15N - sd_d15N)) +
  scale_shape_manual(values = c(0,15,18,1)) +
  theme_classic(base_size = 14) +
  xlim(-35,-20) + ylim(0,5) +
  labs(title = "Baselines comparison w/ means +/- sd", x = "d13C", y = "d15N")

```

###Adding columns specific to each baseline and adding mean C and N for baselines (individual and hybrid/mixed)
*Adding columns specific to each baseline organism*

```{r Adding baseline mean C + N as columns}
### ZOOP ### - Tadenac Lk does not have zoop baselines.*
data$d13C_zoop<-NA
data$d13C_zoop[data$Water == "Baby Lk."] <- -30.69
data$d13C_zoop[data$Water == "Daisy Lk."] <- -32.93
data$d13C_zoop[data$Water == "Nelson Lk."] <- -34.07
data$d13C_zoop[data$Water == "Richardson Lk."] <- -32.220675
data$d15N_zoop<- NA
data$d15N_zoop[data$Water == "Baby Lk."] <- 1.85
data$d15N_zoop[data$Water == "Daisy Lk."] <- 3.10
data$d15N_zoop[data$Water == "Nelson Lk."] <- 3.60
data$d15N_zoop[data$Water == "Richardson Lk."] <- 2.235965

### EPH (Mayfly) ###
data$d13C_eph <- NA
data$d13C_eph[data$Water == "Baby Lk."] <- -28.08
data$d13C_eph[data$Water == "Daisy Lk."] <- -25.88
data$d13C_eph[data$Water == "Nelson Lk."] <- -26.97
data$d13C_eph[data$Water == "Tadenac Lk."] <- -26.92143
data$d13C_eph[data$Water == "Richardson Lk."] <- -25.215266
data$d15N_eph <- NA
data$d15N_eph[data$Water == "Baby Lk."] <- 3.60
data$d15N_eph[data$Water == "Daisy Lk."] <- 1.69
data$d15N_eph[data$Water == "Nelson Lk."] <- 0.88
data$d15N_eph[data$Water == "Tadenac Lk."] <- 3.572857
data$d15N_eph[data$Water == "Richardson Lk."] <- 3.247864

### CLAM ###
data$d13C_clam <- NA
data$d13C_clam[data$Water == "Tadenac Lk."] <- -27.796
data$d13C_clam[data$Water == "Richardson Lk."] <- -30.80193
data$d15N_clam <- NA
data$d15N_clam[data$Water == "Tadenac Lk."] <- 3.595
data$d15N_clam[data$Water == "Richardson Lk."] <- 2.019227

### ZOOP-CLAM ###
data$d13C_zoopclam <- data$d13C_zoop
data$d13C_zoopclam[data$Water == "Tadenac Lk."] <- -27.796
data$d15N_zoopclam <- data$d15N_zoop
data$d15N_zoopclam[data$Water == "Tadenac Lk."] <- 3.595

```


```{r Reformatting the data frame}
##Remove baseline entries as rows + site column (only need for peri)
data<-data[,-c(2)]
data <- data %>%
  filter(!grepl("EPH|ZOOP|PERI|MAYFLY|HEPTAGEN|EPHEMERI|TRICHOPT|CRAYFISH|CLAM|SNAIL", TAXON))

##Removing entries with NA for C/N
data <- data[!is.na(data$d13C),]

##Renaming some of the fish species to match each other
data$TAXON[data$TAXON == "COSHIN"] <- "COSHINER"
data$TAXON[data$TAXON == "NP"] <- "NPIKE"

##Adding size class (prey/pred) for few Richardson entries missing it
data$SIZE[data$Water == "Richardson Lk." & is.na(data$SIZE)] <- "Pred"

##Adding in thermal guild information for all fish species
data$thermguild <- NA
data$thermguild[data$TAXON == "NPIKE"] <- "Cool"
data$thermguild[data$TAXON == "WS"] <- "Cool"
data$thermguild[data$TAXON == "SMB"] <- "Cool"
data$thermguild[data$TAXON == "WALL"] <- "Cool"
data$thermguild[data$TAXON == "COSHINER"] <- "Cool"
data$thermguild[data$TAXON == "CCHUB"] <- "Cool"
data$thermguild[data$TAXON == "PSEED"] <- "Warm"
data$thermguild[data$TAXON == "YPERCH"] <- "Cool"
data$thermguild[data$TAXON == "BBULL"] <- "Warm"
data$thermguild[data$TAXON == "BUR"] <- "Cold"
data$thermguild[data$TAXON == "LT"] <- "Cold"
data$thermguild[data$TAXON == "LWF"] <- "Cold"
data$thermguild[data$TAXON == "CISCO"] <- "Cold"
data$thermguild[data$TAXON == "RSMELT"] <- "Cold"  
data$thermguild[data$TAXON == "BNMIN"] <-  "Cool"
data$thermguild[data$TAXON == "RBASS"] <- "Cool" 
data$thermguild[data$TAXON == "SLSCULP"] <- "Cold"
data$thermguild[data$TAXON == "ALEWIFE"] <- "Cold"
data$thermguild[data$TAXON == "GOSHINER"] <- "Cool"  
data$thermguild[data$TAXON == "NSSTICK"] <- "Cold"

##Adding column for isoscape/biplot colouration
data$colour <- "All other species"
data$colour[data$TAXON == "SMB"] <- "SMB"
data$colour[data$TAXON == "YPERCH"] <- "YPERCH"
  
##Subsetting data by lake (facet issues)
data_bb <- subset(data, data$Water == "Baby Lk.")
data_dy <- subset(data, data$Water == "Daisy Lk.")
data_nl <- subset(data, data$Water == "Nelson Lk.")
data_td <- subset(data, data$Water == "Tadenac Lk.")
data_rc <- subset(data, data$Water == "Richardson Lk.")
  
```

##Plotting the Fish Isoscapes in each lake with 40% CI species ellipses.

```{r Isoscape plots, echo=FALSE, warning=FALSE, message=FALSE}
##################################
########ISOSCAPES BY LAKE#########
##################################

ggplot(data, aes(x = d13C, y = d15N,  colour = TAXON, group = interaction(Water, TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water)

#CJFAS plot - Figure 3
##adding colour for SMB + YP only and symbols for taxon
CJFAS_CN<-ggplot(data, aes(x = d13C, y = d15N, shape = TAXON, colour = colour, group = interaction(Water, TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water)

CJFAS_CN + 
  scale_color_manual(values=c("#999999", "#009E73", "#D55E00")) +
  scale_shape_manual(values = c(1, 2, 3, 4, 17, 6, 7, 8, 9, 10, 11, 12, 25, 14, 15, 16, 17, 5, 0, 20))


```

```{r Test plots: Fish isoscapes for common species across lakes}
#########################
# SMB + YPERCH ELLIPSES #
#########################

##all together
ggplot(subset(data, TAXON %in% c("YPERCH", "SMB")), aes(x = d13C, y = d15N, colour = Water, shape = TAXON, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  xlim(-35,-18) + ylim(3,14) +
  labs(title = "Common fish isotopes across lakes", x = "d13C", y = "d15N")

##facetted
ggplot(subset(data, TAXON %in% c("YPERCH", "SMB")), aes(x = d13C, y = d15N, colour = TAXON, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water) +
  labs(title = "40% Ellipse")

ggplot(subset(data, TAXON %in% c("YPERCH", "SMB")), aes(x = d13C, y = d15N, colour = TAXON, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.95, lwd = 1.5) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water) +
  labs(title = "95% Ellipse")

################
# W/ BASELINES #
################
yp_smb <- data %>%
  filter(grepl("YPERCH|SMB", TAXON))
bd <- base_data %>%
  filter(grepl("MAYFLY|TRICHOPT|ZOOP|CLAM", TAXON))


##FACETTED
ggplot(yp_smb, aes(x = d13C, y = d15N, colour = TAXON, group = interaction(Water,TAXON))) +
  geom_point() +
  stat_ellipse(type = "norm", level = 0.4, lwd = 1.5) +
  geom_point(data = bd) +
  theme_classic(base_size = 14) +
  facet_wrap(~Water)

```

```{r Calculating proportion littoral energy usage, echo=FALSE}

###################
##  STUDY LAKES  ##
###################
#mayfly (L) ; zoop (P)
data$prop_litt_EZ <- (data$d13C - data$d13C_zoop)/(data$d13C_eph - data$d13C_zoop)

###################
##  STUDY + REF  ##
###################
#eph (L) ; zoop/clam - TADENAC (P)
data$prop_litt_EZ <- (data$d13C - data$d13C_zoopclam)/(data$d13C_eph - data$d13C_zoopclam)
data<- data[!is.na(data$prop_litt_EZ),]
hist(data$prop_litt_EZ)

#adjusted (<0 and 100<)
data$adjprop_litt_EZ <- NA
data$adjprop_litt_EZ = data$prop_litt_EZ
data$adjprop_litt_EZ[data$prop_litt_EZ>1] <- 1.00
data$adjprop_litt_EZ[data$prop_litt_EZ<0] <- 0.00
hist(data$adjprop_litt_EZ)

```

```{r Trophic Position calculation, echo=FALSE}
##trophic position

### TWO BASELINE TP CALCULATION ###
# two baseline
bigdat$tp_2 <- 2 + ((bigdat$d15N - ((bigdat$d15N_zoopclam*(1 - bigdat$prop_litt_EZ)) + (bigdat$d15N_eph*bigdat$prop_litt_EZ)))/3.4)

#summarize data for plots
data_sum_tp <- bigdat %>% group_by(Water, TAXON) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.tp2 = mean(tp_2), sd.tp2 = sd(tp_2))

#tpdat <- bigdat[c(1,2,26,27)]

```

#PLOTTING MEAN PROPORTION LITTORAL ENERGY USAGE#

```{r Summarizing data to make proportion littoral plots}
#summarize data for plots 
data_sum <- data %>% group_by(Water, TAXON) %>%
  summarise(mean.pl = mean(prop_litt_EZ), sd.pl = sd(prop_litt_EZ), mean.adjpl = mean(adjprop_litt_EZ), sd.adjpl = sd(adjprop_litt_EZ))

#create master data frame w/ all baseline C/Ns, mean prop littoral
bigdat <- merge(data, data_sum, by = c("Water", "TAXON"))
  
##############
###  PLOT  ###
##############

smbyplab <- c("Smallmouth bass", "Yellow perch")

##MEAN +/- sd
unadjpl <- ggplot(subset(bigdat, TAXON %in% c("SMB", "YPERCH")), aes(x = TAXON, y = mean.pl, colour = TAXON, group = TAXON)) +
  geom_point(show.legend = FALSE) +
  geom_errorbar(aes(ymax = mean.pl + sd.pl, ymin = mean.pl - sd.pl), show.legend = FALSE) +
  xlab("Fish species") +
  ylab("Mean proportion littoral energy usage +/- sd") +
  scale_y_continuous() +
  scale_x_discrete(labels = smbyplab, guide = guide_axis(n.dodge=2)) +
  scale_colour_manual(labels = c("Smallmouth bass", "Yellow perch"), values = c("black", "grey")) +
  facet_wrap(~Water)+
  theme_bw()

plot(unadjpl)

#adj
adjpl <- 
  ggplot(subset(bigdat, TAXON %in% c("SMB", "YPERCH")), aes(x = TAXON, y = mean.adjpl, colour = TAXON, group = TAXON)) +
  geom_point(show.legend = FALSE) +
  geom_errorbar(aes(ymax = mean.adjpl + sd.adjpl, ymin = mean.adjpl - sd.adjpl), show.legend = FALSE) +
  xlab("Fish species") +
  ylab("Mean proportion littoral energy +/- sd (adjusted)") +
  scale_y_continuous() +
  scale_x_discrete(labels = smbyplab, guide = guide_axis(n.dodge=2)) +
  scale_colour_manual(labels = c("Smallmouth bass", "Yellow perch"), values = c("black", "grey")) +
  facet_wrap(~Water)+
  theme_bw() 

plot(adjpl)

adjpl + geom_point(data = subset(bigdat, TAXON %in% c("SMB", "YPERCH")), aes(x = TAXON, y = adjprop_litt_EZ), shape = 1)

library(cowplot)
plot_grid(unadjpl, adjpl, labels = "AUTO")


```

```{r ANOVA/ANCOVA proportion littoral and TP}
library(emmeans)

##SMB adj prop littoral data
bigdat$TAXON <- as.factor(bigdat$TAXON)
smb_adjPL <- adjPL_SMB_YP %>%
  filter(grepl("SMB", TAXON))

###ANOVA
smb_pl_aov<-lm(adjprop_litt_EZ ~ Water, data = smb_adjPL)
anova(smb_pl_aov)
###contrasts
TukeyHSD(smb_pl_aov, which = "Water")

##YP adj prop littoral data
yp_adjPL <- adjPL_SMB_YP %>%
  filter(grepl("YP", TAXON))

###ANOVA
yp_pl_aov<-lm(adjprop_litt_EZ ~ Water, data = yp_adjPL)
anova(yp_pl_aov)

#Do we do Tukeys here? No? Should we do Tukeys anywhere?
###contrasts
#TukeyHSD(yp_pl_aov, which = "Water")

###ANCOVA
YP_PLFLEN<-emmeans(yp_pl_aov, pairwise ~ Water, adjust = "none")
YP_PLFLEN

x<-as.data.frame(summary(YP_PLFLEN)$emmeans)

#plot for PL adj with body size correction
ggplot(x, aes(x=Water, y=emmean))+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2)+
  geom_point()

##TP + size correction
##SMB
smbTP <- bigdat %>%
  filter(grepl("SMB", TAXON))

smb_tp_aov<-lm(tp_2 ~ Water + FLEN, data = smbTP)
anova(smb_tp_aov)

#YP
ypTP <- bigdat %>%
  filter(grepl("YPERCH", TAXON))
yp_tp_aov<-lm(tp_2 ~ Water + FLEN, data = ypTP)
anova(yp_tp_aov)

```
###OLD prop littoral range info... is this needed?
> range(data$prop_littoral)
[1] -0.815508  1.743316
> mean(data$prop_littoral)
[1] 0.8562738
> median(data$prop_littoral)
[1] 0.9117647

> range(data$prop_littoral2)
[1] -1.168582  2.498084
> mean(data$prop_littoral2)
[1] 0.8460624
> median(data$prop_littoral2)
[1] 0.7676056

```{r Matt code - TP, echo=FALSE}
##trophic position
### CALC USING ZOOP (+ CLAM FOR TADENAC) ###
bigdat$tp_ZC <- 2 + ((bigdat$d15N - bigdat$d15N_zoopclam)/3.4)

### CALC USING EPH ###
bigdat$tp_EPH <- 2 + ((bigdat$d15N - bigdat$d15N_eph)/3.4)

# two baseline
bigdat$tp_2 <- 2 + ((bigdat$d15N - ((bigdat$d15N_zoopclam*(1 - bigdat$prop_litt_EZ)) + (bigdat$d15N_eph*bigdat$prop_litt_EZ)))/3.4)

#summarize data for plots
data_sum_tp <- bigdat %>% group_by(Water, TAXON) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.tp2 = mean(tp_2), sd.tp2 = sd(tp_2))

tpdat <- bigdat[c(1,2,26,27)]

###AOV for length

```

```{r plots}
###############
###  PLOTS  ###
###############

#####ALL FISH SPC#####

#Zoop - mean
ggplot(data_sum_tp, aes(x = TAXON, y = mean.tp.zoop, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Zoop - quantile boxplot
ggplot(bigdat, aes(x = TAXON, y = tp_ZC, fill = thermguild, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Trophic Position (zoop) w/ thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Mayfly - mean
ggplot(data_sum_tp, aes(x = TAXON, y = mean.tp.eph, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#Mayfly - quantile
ggplot(bigdat, aes(x = TAXON, y = tp_EPH, fill = thermguild, group = TAXON)) +
  geom_boxplot() +
  xlab("Fish species") +
  ylab("Trophic Position (eph/tri) w/ thermal guild") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#TP 2 - MEAN
ggplot(data_sum_tp, aes(x = TAXON, y = mean.tp2, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp2 + sd.tp2, ymin = mean.tp2 - sd.tp2)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (TP2)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

```

###OLD TP range info... is this needed?
> range(data$tp_ZCS)
[1] 2.270588 5.223529
> mean(data$tp_ZCS)
[1] 3.571591
> median(data$tp_ZCS)
[1] 3.523529

> range(data$tp_EPHTRI)
[1] 1.950000 5.45
> mean(data$tp_EPHTRI)
[1] 3.682063
> median(data$tp_EPHTRI)
[1] 3.722581

#PLOTTING TROPHIC POSITION FOR COMMON FISH SPECIES#

```{r Subset TP plots}
#######################
###YPERCH + SMB ONLY###
#######################

## ZOOP
ggplot(subset(data_sum_tp, TAXON %in% c("YPERCH", "SMB")), aes(x = TAXON, y = mean.tp.zoop, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## MAYFLY
ggplot(subset(data_sum_tp, TAXON %in% c("YPERCH", "SMB")), aes(x = TAXON, y = mean.tp.eph, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

##MIXED TP
smbyplab <- c("Smallmouth bass", "Yellow perch")

ggplot(subset(data_sum_tp, TAXON %in% c("YPERCH", "SMB")), aes(x = TAXON, y = mean.tp2, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp2 + sd.tp2, ymin = mean.tp2 - sd.tp2)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (two end mixed)") +
  scale_y_continuous() +
  scale_x_discrete(labels = smbyplab, guide = guide_axis(n.dodge=2)) +
  scale_colour_manual(labels = c("Smallmouth bass", "Yellow perch"), values = c("black", "grey")) +
  facet_wrap(~Water)+
  theme_bw() +
  theme(axis.text.x = element_text())

test1<-ggplot(subset(data_sum_tp, TAXON %in% c("YPERCH", "SMB")), aes(x = TAXON, y = mean.tp2, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp2 + sd.tp2, ymin = mean.tp2 - sd.tp2)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (two end mixed)") +
  scale_y_continuous() +
  scale_x_discrete(labels = smbyplab, guide = guide_axis(n.dodge=2)) +
  scale_colour_manual(labels = c("Smallmouth bass", "Yellow perch"), values = c("black", "grey")) +
  facet_wrap(~Water)+
  theme_bw() +
  theme(axis.text.x = element_text())

test1 + geom_point(data = subset(bigdat, TAXON %in% c("YPERCH", "SMB")), aes(x = TAXON, y = tp_2), shape = 1)

##################
## NPIKE, PSEED ##
##################

## ZOOP
ggplot(subset(data_sum_tp, TAXON %in% c("NPIKE", "PSEED")), aes(x = TAXON, y = mean.tp.zoop, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## MAYFLY
ggplot(subset(data_sum_tp, TAXON %in% c("NPIKE", "PSEED")), aes(x = TAXON, y = mean.tp.eph, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Fish species") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

####################################
#####ANOVA w TUKEYS HSD for TP######
####################################
tpdat_SMBYP <- tpdat %>%
  filter(grepl("YPERCH|SMB", TAXON))

stderror <- function(x) sd(x)/sqrt(length(x))

tpdat_SMB <- tpdat_SMBYP %>%
  filter(grepl("SMB", TAXON))
tpdat_SMB_sum <- tpdat_SMB %>% group_by(TAXON, Water) %>%
  summarise(mean.tp2 = mean(tp_2, na.rm = T), sd.tp2 = sd(tp_2, na.rm = T), se.tp2 = stderror(tp_2))

tpdat_YP <- tpdat_SMBYP %>%
  filter(grepl("YPERCH", TAXON))
tpdat_YP_sum <- tpdat_YP %>% group_by(TAXON, Water) %>%
  summarise(mean.tp2 = mean(tp_2, na.rm = T), sd.tp2 = sd(tp_2, na.rm = T), se.tp2 = stderror(tp_2))

smb_tp_aov<-aov(tp_2 ~ Water*FLEN, data = tpdat_SMB)
summary(smb_tp_aov)
TukeyHSD(smb_tp_aov, which = "Water")

yp_tp_aov<-aov(tp_2 ~ Water, data = tpdat_YP)
summary(yp_tp_aov)
TukeyHSD(yp_tp_aov, which = "Water")

#####################
## LAKE AVERAGE TP ##
#####################

## SUBSETTING DATA
lake_sum_tp <- bigdat %>% group_by(Water) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.tp2 = mean(tp_2), sd.tp2 = sd(tp_2))

lake_tp_aov<-aov(tp_2 ~ Water, data = tpdat)
summary(lake_tp_aov)
TukeyHSD(lake_tp_aov, which = "Water")


## ZOOP
ggplot(lake_sum_tp, aes(x = Water, y = mean.tp.zoop, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  theme(axis.text.x = element_text(angle = 45))

## MAYFLY
ggplot(lake_sum_tp, aes(x = Water, y = mean.tp.eph, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  theme(axis.text.x = element_text(angle = 45))

## MIXED
ggplot(lake_sum_tp, aes(x = Water, y = mean.tp2, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp2 + sd.tp2, ymin = mean.tp2 - sd.tp2)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (mixed)") +
  scale_y_continuous() +
  scale_x_discrete() +
  theme(axis.text.x = element_text(angle = 45))

#############################
## LAKE AVG W/ COARSE SIZE ##
#############################
lake_size_sum_tp <- bigdat %>% group_by(Water, SIZE) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.tp2 = mean(tp_2), sd.tp2 = sd(tp_2))

## ZOOP
ggplot(lake_size_sum_tp, aes(x = SIZE, y = mean.tp.zoop, colour = SIZE)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Fish size") +
  ylab("Whole-lake Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

## MAYFLY
ggplot(lake_size_sum_tp, aes(x = SIZE, y = mean.tp.eph, colour = SIZE)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))


### JUST SMB, YPERCH, NPIKE, PSEED W/ COARSE SIZE ###
dat1 <- bigdat %>% group_by(Water, TAXON, SIZE) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.tp2 = mean(tp_2), sd.tp2 = sd(tp_2))

sm_lakesize_tp <- dat1 %>%
  filter(grepl("YPERCH|SMB|NPIKE|PSEED", TAXON))

## ZOOP
ggplot(sm_lakesize_tp, aes(x = TAXON, y = mean.tp.zoop, colour = SIZE)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.zoop + sd.tp.zoop, ymin = mean.tp.zoop - sd.tp.zoop)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (zoop)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

## MAYFLY
ggplot(sm_lakesize_tp, aes(x = TAXON, y = mean.tp.eph, colour = SIZE)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.tp.eph + sd.tp.eph, ymin = mean.tp.eph - sd.tp.eph)) +
  xlab("Lake") +
  ylab("Whole-lake Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

```

#PREPPING SIZE DATA
```{r Import, tidy, stitch size data w C/N}

#Filter for lakes of interest and remove baselines
size_studyl <- read_csv("../data/LCAR_SIA_Database.csv")
size_td <- read_csv("../data/Tom-ExtraLakes-Isotopes-2021Apr09.csv")
size_td <- size_td %>%
  filter(grepl("Tadenac", WBY)) %>%
  filter(!grepl("MAYFLY|CLAM|EPHEMERI", TAXON))
  
size_rc <- read_csv("../data/RichardsonL_SIA-data.csv")
size_rc <- size_rc %>%
  filter(grepl("Richardson", Lake_Name)) %>%
  filter(!grepl("Baseline", Trophic_Level))

#Remove to have only necessary fields and renaming to common "SIASAM"
size_studyl<-size_studyl[,c(1,9:11)]
size_studyl<-size_studyl[-c(172:175),]

size_td <- size_td[,c(1,9:11)]
size_td <- size_td %>%
  rename(SIASAM = `SIA SAM`)

size_rc <- size_rc[,c(5,15,27:29)]
size_rc <- size_rc %>%
  rename(SIASAM = SI_ID)
###Richardson SIASAM values not included in 'bigdat' so trying to stitch using d13C_Cor

##stitching data together
sizedat1 <- rbind(size_studyl, size_td)

test <- merge(bigdat, sizedat1, by = "SIASAM")
test2 <- merge(bigdat, size_rc, by = "d13C_Cor")  ###rearrange to match test and remove duplicate SIASAM column

test2 <- test2[,-c(4)]
test2 <- test2 %>%
  rename(SIASAM = SIASAM.y)

test2 <- test2[,c(27,2:7,1,8:26,28:30)]

#stitching together to update 'bigdat'
bigdat <- rbind(test,test2)

bigdat[,28:30] <- sapply(bigdat[,28:30], as.numeric)

```

#TROPHIC POSITION OF COMMON SPECIES W/ BODY SIZE#

```{r TP w/ body size}
#plot y = tp and x = tlen/flen 
############
## MAYFLY ##
############
## RWT
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = RWT, y = tp_EPH, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = RWT, y = tp_EPH, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## FLEN/TLEN
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = TLEN, y = tp_EPH, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = TLEN, y = tp_EPH, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

##########
## ZOOP ##
##########
## RWT
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = RWT, y = tp_ZC, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = RWT, y = tp_ZC, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## TLEN
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = TLEN, y = tp_ZC, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = TLEN, y = tp_ZC, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

############
## MIXED  ##
############
## RWT
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = RWT, y = tp_2, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (mixed)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = RWT, y = tp_2, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position +/- sd (mixed)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## FLEN/TLEN
#SMB
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = TLEN, y = tp_2, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (mixed)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))
#YPERCH
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = TLEN, y = tp_2, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (mixed)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

#########################
###  COMPARISON PLOT  ###
#########################
### SMB ###
# TLEN
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = TLEN)) +
  geom_point(aes(y=tp_2, colour = "red")) +
  geom_point(aes(y=tp_EPH, colour = "gree")) +
  geom_point(aes(y=tp_ZC, colour = "blue")) +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position") +
  scale_colour_manual(labels = c("Zoop/Clam", "EPH", "Mixed"), values = c("black", "dark grey", "light grey")) +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45))

# RWT
ggplot(subset(bigdat, TAXON %in% c("SMB")), aes(x = RWT)) +
  geom_point(aes(y=tp_2, colour = "red")) +
  geom_point(aes(y=tp_EPH, colour = "green")) +
  geom_point(aes(y=tp_ZC, colour = "blue")) +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position") +
  scale_colour_manual(labels = c("Zoop/Clam", "EPH", "Mixed"), values = c("red", "green", "blue")) +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

### YPERCH ###
# TLEN
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = TLEN)) +
  geom_point(aes(y=tp_2, colour = "red")) +
  geom_point(aes(y=tp_EPH, colour = "green")) +
  geom_point(aes(y=tp_ZC, colour = "blue")) +
  xlab("TLEN (mm)") +
  ylab("Mean Trophic Position") +
  scale_colour_manual(labels = c("Zoop/Clam", "EPH", "Mixed"), values = c("red", "green", "blue")) +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

# RWT
ggplot(subset(bigdat, TAXON %in% c("YPERCH")), aes(x = RWT)) +
  geom_point(aes(y=tp_2, colour = "red")) +
  geom_point(aes(y=tp_EPH, colour = "green")) +
  geom_point(aes(y=tp_ZC, colour = "blue")) +
  xlab("RWT (g)") +
  ylab("Mean Trophic Position") +
  scale_colour_manual(labels = c("Zoop/Clam", "EPH", "Mixed"), values = c("red", "green", "blue")) +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

```

```{r Mean and SD calculations for TP and body size}
sumsizeTP <- bigdat %>%
  group_by(Water, TAXON) %>%
  summarise(mean.tp.zoop = mean(tp_ZC), sd.tp.zoop = sd(tp_ZC), mean.tp.eph = mean(tp_EPH), sd.tp.eph = sd(tp_EPH), mean.flen = mean(FLEN), sd.flen = sd(FLEN), mean.rwt = mean(RWT), sd.rwt = sd(RWT), mean.tlen = mean(TLEN), sd.tlen = sd(TLEN))

subset <- bigdat[, c(2,3, 24:30)]
  
sumsizeTP <- subset %>%
  filter(!is.na(RWT) & !is.na(TLEN) & !is.na(FLEN)) %>%
  group_by(Water, TAXON) %>%
  summarise_all(list(mean = mean, sd = sd))

commonsumsizeTP <- sumsizeTP %>%
  filter(grepl("YPERCH|SMB|NPIKE|PSEED",TAXON))
```

```{r TP w standardized body size}
#################
###    TLEN   ###
#################
#EPH
ggplot(commonsumsizeTP, aes(x = TLEN_mean, y = tp_EPH_mean, colour = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_EPH_mean + tp_EPH_sd, ymin = tp_EPH_mean - tp_EPH_sd)) +
  xlab("Mean TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

ggplot(commonsumsizeTP, aes(x = TLEN_mean, y = tp_EPH_mean, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_EPH_mean + tp_EPH_sd, ymin = tp_EPH_mean - tp_EPH_sd)) +
  xlab("Mean TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~TAXON) +
  theme(axis.text.x = element_text(angle = 45))

#ZOOP
ggplot(commonsumsizeTP, aes(x = TLEN_mean, y = tp_ZC_mean, colour = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_ZC_mean + tp_ZC_sd, ymin = tp_ZC_mean - tp_ZC_sd)) +
  xlab("Mean TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

ggplot(commonsumsizeTP, aes(x = TLEN_mean, y = tp_ZC_mean, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_ZC_mean + tp_ZC_sd, ymin = tp_ZC_mean - tp_ZC_sd)) +
  xlab("Mean TLEN (mm)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~TAXON) +
  theme(axis.text.x = element_text(angle = 45))


#################
###    RWT    ###
#################
#EPH
ggplot(commonsumsizeTP, aes(x = RWT_mean, y = tp_EPH_mean, colour = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_EPH_mean + tp_EPH_sd, ymin = tp_EPH_mean - tp_EPH_sd)) +
  xlab("Mean RWT (g)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

ggplot(commonsumsizeTP, aes(x = RWT_mean, y = tp_EPH_mean, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_EPH_mean + tp_EPH_sd, ymin = tp_EPH_mean - tp_EPH_sd)) +
  xlab("Mean RWT (g)") +
  ylab("Mean Trophic Position +/- sd (eph)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~TAXON) +
  theme(axis.text.x = element_text(angle = 45))

#ZOOP
ggplot(commonsumsizeTP, aes(x = RWT_mean, y = tp_ZC_mean, colour = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_ZC_mean + tp_ZC_sd, ymin = tp_ZC_mean - tp_ZC_sd)) +
  xlab("Mean RWT (g)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water) +
  theme(axis.text.x = element_text(angle = 45))

ggplot(commonsumsizeTP, aes(x = RWT_mean, y = tp_ZC_mean, colour = Water)) +
  geom_point() +
  geom_errorbar(aes(ymax = tp_ZC_mean + tp_ZC_sd, ymin = tp_ZC_mean - tp_ZC_sd)) +
  xlab("Mean RWT (g)") +
  ylab("Mean Trophic Position +/- sd (zoop/clam)") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~TAXON) +
  theme(axis.text.x = element_text(angle = 45))

```







```{r C:N Ratio (Condition) for YP and SMB}

##SUBSETTING DATA/MAKING DF
sumCN <- bigdat %>%
  group_by(Water, TAXON) %>%
  summarise(mean.CN = mean(C.N), sd.CN = sd(C.N), mean.flen = mean(FLEN), sd.flen = sd(FLEN), mean.rwt = mean(RWT), sd.rwt = sd(RWT), mean.tlen = mean(TLEN), sd.tlen = sd(TLEN))

#######################
# C:N SCATTER W/ SIZE #
#######################
## RWT
ggplot(subset(bigdat, TAXON %in% c("YPERCH","SMB")), aes(x = RWT, y = C.N, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("RWT (g)") +
  ylab("C:N Ratio") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))

## FLEN/TLEN
ggplot(subset(bigdat, TAXON %in% c("YPERCH","SMB")), aes(x = TLEN, y = C.N, colour = TAXON, group = TAXON)) +
  geom_point() +
  xlab("TLEN (mm)") +
  ylab("C:N Ratio") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))


#################
##  C:N MEAN  ##
#################
#SMB + YPERCH
ggplot(subset(sumCN, TAXON %in% c("SMB", "YPERCH")), aes(x = TAXON, y = mean.CN, colour = TAXON, group = TAXON)) +
  geom_point() +
  scale_color_grey(start= 0.1, end = 0.5) +
  geom_errorbar(aes(ymax = mean.CN + sd.CN, ymin = mean.CN - sd.CN)) +
  xlab("Smallmouth bass and Yellow perch communities by Lake") +
  ylab("Mean C:N Ratio +/- sd") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 45))

#TLEN
ggplot(subset(sumCN, TAXON %in% c("SMB","YPERCH")), aes(x = mean.tlen, y = mean.CN, colour = TAXON, group = TAXON)) +
  geom_point() +
  geom_errorbar(aes(ymax = mean.CN + sd.CN, ymin = mean.CN - sd.CN)) +
  xlab("TLEN (mm)") +
  ylab("Mean C:N Ratio +/- sd") +
  scale_y_continuous() +
  scale_x_continuous() +
  facet_wrap(~Water)+
  theme(axis.text.x = element_text(angle = 45))


#subsetting for C:N by spp.
data_CN <- bigdat[,c(1:3,6)]
data_CN_YP <- data_CN[data_CN$TAXON == "YPERCH",]
data_CN_SMB <- data_CN[data_CN$TAXON == "SMB",]

yp_cn_aov<-aov(C.N ~ Water, data = data_CN_YP)
summary(yp_cn_aov)

TukeyHSD(yp_cn_aov, which = "Water")

smb_cn_aov<-aov(C.N ~ Water, data = data_CN_SMB)
summary(smb_cn_aov)

TukeyHSD(smb_cn_aov, which = "Water")
```

```{r Condition - Fulton's index}
#add FI to masterdata frame
bigdat$FI <- NA
bigdat$FI <- ifelse(is.na(bigdat$FLEN), (bigdat$RWT/(bigdat$TLEN^3)) * 100000, (bigdat$RWT/(bigdat$FLEN^3)) * 100000)

##SUBSETTING DATA/MAKING DF
FIdat <- bigdat[!is.na(bigdat$FI),]
sumFI <- FIdat %>%
  group_by(Water, TAXON) %>%
  summarise(mean.FI = mean(FI), sd.FI = sd(FI))

ggplot(subset(sumFI, TAXON %in% c("SMB","YPERCH")), aes(x = TAXON, y = mean.FI, colour = TAXON, group = TAXON)) +
  geom_point() +
  scale_color_grey(start = 0.1, end = 0.5) +
  geom_errorbar(aes(ymax = mean.FI + sd.FI, ymin = mean.FI - sd.FI)) +
  xlab("Smallmouth bass and Yellow perch communities by Lake") +
  ylab("Mean Fulton's Index +/- sd") +
  scale_y_continuous() +
  scale_x_discrete() +
  facet_wrap(~Water)+
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45))

```

```{r ANOVA sig. differences between lakes FI}
#subsetting for FI by spp.
data_FI <- bigdat[,c(1:3,31)]
data_FI_YP <- data_FI[data_FI$TAXON == "YPERCH",]
data_FI_SMB <- data_FI[data_FI$TAXON == "SMB",]

yp_fi_aov<-aov(FI ~ Water, data = data_FI_YP)
summary(yp_fi_aov)

TukeyHSD(yp_fi_aov, which = "Water")

smb_fi_aov<-aov(FI ~ Water, data = data_FI_SMB)
summary(smb_fi_aov)

TukeyHSD(smb_fi_aov, which = "Water")
```


